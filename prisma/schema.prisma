generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  username       String           @id @unique @db.VarChar(50)
  password       String           @db.VarChar(100)
  phoneNumber    String           @db.VarChar(12)
  role           enum_Users_role
  createdAt      DateTime?        @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime?        @updatedAt @db.Timestamptz(6)
  targetContacts targetContacts[]
  teamUsers      teamUsers[]
}

model targets {
  address        String
  method         enum_method
  createdAt      DateTime?        @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime?        @updatedAt @db.Timestamptz(6)
  targetContacts targetContacts[]
  teamTarget     teamTarget[]

  @@id([address, method])
  @@unique([address, method])
}

model alertLogs {
  id        Int          @id @default(autoincrement())
  job       String       @db.VarChar(50)
  instance  String       @db.VarChar(50)
  method    enum_method?
  value     Int
  activeAt  DateTime
  createdAt DateTime?    @default(now()) @db.Timestamptz(6)
  updatedAt DateTime?    @updatedAt @db.Timestamptz(6)

}

model targetContacts {
  targetAddress String
  method        enum_method
  username      String      @db.VarChar(50)
  target        targets     @relation(fields: [targetAddress, method], references: [address, method])
  userContact   users       @relation(fields: [username], references: [username])

  @@id([username, targetAddress, method])
}

model teams {
  teamName   String       @id @db.VarChar(50)
  teamUsers  teamUsers[]
  teamTarget teamTarget[]
}

model teamUsers {
  teamName String @db.VarChar(20)
  username String @db.VarChar(50)
  team     teams  @relation(fields: [teamName], references: [teamName])
  user     users  @relation(fields: [username], references: [username])

  @@id([username, teamName])
}

model teamTarget {
  teamName      String      @db.VarChar(20)
  targetAddress String      @db.VarChar(50)
  method        enum_method
  team          teams       @relation(fields: [teamName], references: [teamName])
  target        targets     @relation(fields: [targetAddress, method], references: [address, method])


  @@id([teamName, targetAddress, method])
}

enum enum_method {
  ping
  http_request
}

enum enum_Users_role {
  ROOT
  MONIA_ADMIN
  MONITORING_ADMIN
  CONTACT
}
